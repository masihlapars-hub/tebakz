<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tebak Tebakan</title>
<style>
  :root{
    --primary:#4a6fa5; --secondary:#6b8cbc; --bg:#f5f7fa; --text:#333; --card:#fff;
  }
  .dark{ --primary:#7b1fa2; --secondary:#9c27b0; --bg:#121212; --text:#eaeaea; --card:#1e1e1e; }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{margin:0;background:var(--bg);color:var(--text);transition:.2s}
  header{background:var(--primary);color:#fff}
  nav{max-width:1200px;margin:auto;display:flex;gap:16px;align-items:center;justify-content:space-between;padding:14px 20px}
  .logo{font-weight:700;font-size:22px}
  .nav a{color:#fff;text-decoration:none;padding:6px 10px;border-radius:6px}
  .nav a:hover{background:rgba(255,255,255,.15)}
  .container{max-width:1200px;margin:16px auto;padding:0 16px}
  .page{display:none;min-height:70vh}
  .page.active{display:block}
  .card{background:var(--card);border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.08);padding:18px;margin-bottom:18px}
  .btn{background:var(--primary);color:#fff;border:0;border-radius:8px;padding:10px 14px;cursor:pointer;font-weight:600}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn.outline{background:transparent;color:var(--primary);border:2px solid var(--primary)}
  .btn.warn{background:#e53935}
  .row{display:flex;flex-wrap:wrap;gap:12px}
  .col{flex:1 1 260px}
  label{font-weight:700;display:block;margin-bottom:6px}
  input,select,textarea{width:100%;padding:10px;border:1px solid #d8dbe2;border-radius:8px;background:var(--card);color:var(--text)}
  textarea{min-height:80px}
  .avatar-grid{display:grid;grid-template-columns:repeat(auto-fill,72px);gap:12px}
  .avatar{width:72px;height:72px;border-radius:50%;object-fit:cover;border:3px solid transparent;cursor:pointer}
  .avatar.active{border-color:var(--primary)}
  .levels button{margin:4px}
  .option{padding:12px;border:2px solid #e0e3ea;border-radius:10px;cursor:pointer}
  .option.selected{border-color:var(--primary);background:rgba(74,111,165,.09)}
  .progress{height:8px;background:#e9eef7;border-radius:999px;overflow:hidden;margin:10px 0}
  .bar{height:100%;width:0;background:var(--primary)}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid #eaecef;padding:8px;text-align:left}
  th{background:#eef2ff}
  .muted{opacity:.7}
  .right{display:flex;gap:8px;align-items:center}
  .hidden{display:none}
  @media(max-width:720px){ .nav .right{display:none} }
</style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">Tebak Tebakan</div>
      <div class="nav right">
        <a href="#" data-goto="home">Home</a>
        <a href="#" data-goto="scores">Top Score</a>
        <a href="#" id="adminLink">Admin</a>
        <a href="#" id="logoutBtn">Logout</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <!-- LOGIN -->
    <section id="login" class="page active">
      <div class="card">
        <h2>Login Pemain</h2>
        <div class="row">
          <div class="col">
            <label>Nama Pemain</label>
            <input id="playerName" placeholder="Masukkan nama Anda">
          </div>
        </div>

        <h3 style="margin-top:14px">Pilih Avatar</h3>
        <div id="avatarWrap" class="avatar-grid"></div>

        <h3 style="margin-top:14px">Pilih Tema</h3>
        <div class="row" id="themeWrap"></div>

        <button class="btn" id="startBtn" style="margin-top:14px">Mulai Bermain</button>
      </div>
    </section>

    <!-- HOME -->
    <section id="home" class="page">
      <div class="card">
        <h2>Selamat datang, <span id="hiName">Pemain</span>!</h2>
        <p class="muted">Pilih kategori & tingkat kesulitan.</p>
      </div>
      <div id="cats" class="row"></div>
    </section>

    <!-- QUIZ -->
    <section id="quiz" class="page">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h3 id="qCat">Kategori:</h3>
          <div class="muted" id="qMeta">Level · 0/0</div>
        </div>
        <div class="progress"><div id="qProg" class="bar"></div></div>
        <h3 id="qText">Pertanyaan…</h3>
        <img id="qImg" class="hidden" style="max-width:100%;max-height:240px;border-radius:10px;margin:10px 0">
        <div id="opts" class="row" style="flex-direction:column"></div>
        <button class="btn" id="nextBtn" style="margin-top:12px">Selanjutnya</button>
      </div>
    </section>

    <!-- HASIL -->
    <section id="result" class="page">
      <div class="card">
        <h2>Hasil Kuis</h2>
        <p id="scoreText">Skor: 0/0</p>
        <div id="answerList"></div>
        <button class="btn" data-goto="home" style="margin-top:12px">Kembali ke Home</button>
      </div>
    </section>

    <!-- SCORES -->
    <section id="scores" class="page">
      <div class="card">
        <h2>Top Score</h2>
        <p id="emptyScore" class="muted">Belum ada skor.</p>
        <div style="overflow:auto">
          <table id="scoreTable"><thead>
            <tr><th>#</th><th>Nama</th><th>Skor</th><th>Benar/Total</th><th>Kategori</th><th>Level</th><th>Durasi</th><th>Tanggal</th></tr>
          </thead><tbody></tbody></table>
        </div>
        <button class="btn warn" id="resetScores">Reset Top Score</button>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="admin" class="page">
      <div class="card">
        <h2>Panel Admin</h2>
        <p class="muted">Password admin diperlukan saat membuka (default: 281105).</p>
      </div>

      <div class="card">
        <h3>Tambah Soal</h3>
        <div class="row">
          <div class="col">
            <label>Kategori</label>
            <select id="aCat"></select>
          </div>
          <div class="col">
            <label>Level</label>
            <select id="aLvl">
              <option value="mudah">Mudah</option>
              <option value="normal">Normal</option>
              <option value="sulit">Sulit</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col" style="flex:1 1 100%">
            <label>Pertanyaan</label>
            <textarea id="aQ"></textarea>
          </div>
        </div>

        <div class="row">
          <div class="col"><label>Opsi A</label><input id="aA"></div>
          <div class="col"><label>Opsi B</label><input id="aB"></div>
          <div class="col"><label>Opsi C</label><input id="aC"></div>
          <div class="col"><label>Opsi D</label><input id="aD"></div>
        </div>

        <div class="row">
          <div class="col"><label>URL Gambar (opsional)</label><input id="aImg" placeholder="./static/whatever.jpg"></div>
          <div class="col"><label>Jawaban Benar</label>
            <select id="aAns"><option value="a">A</option><option value="b">B</option><option value="c">C</option><option value="d">D</option></select>
          </div>
        </div>

        <button class="btn" id="addQ">Tambah Soal</button>
      </div>

      <div class="card">
        <h3>Kelola Bank Soal</h3>
        <div class="row">
          <div class="col"><button class="btn outline" id="importFile">Impor JSON (File)</button></div>
          <div class="col"><button class="btn outline" id="exportCopy">Ekspor JSON (Copy)</button></div>
          <div class="col"><button class="btn outline" id="downloadJson">Unduh JSON</button></div>
        </div>
        <p class="muted" style="margin-top:10px">
          <strong>Catatan:</strong> setelah ekspor/copy, buka repo GitHub → file <code>questions.json</code> → paste & commit.
          Semua pemain akan baca file itu otomatis.
        </p>
        <div id="adminList" style="margin-top:12px"></div>
      </div>
    </section>
  </main>

<script>
/* ========== STATE DASAR ========== */
const ADMIN_PASSWORD = "281105";

const app = {
  player: {name:"", avatar:"", theme:"light"},
  scores: [],
  categories: [
    {id:"ipa",name:"IPA",desc:"Ilmu Pengetahuan Alam"},
    {id:"ips",name:"IPS",desc:"Ilmu Pengetahuan Sosial"},
    {id:"utbk",name:"UTBK",desc:"Ujian Tulis Berbasis Komputer"},
    {id:"agama",name:"Pendidikan Agama",desc:"Umum"},
    {id:"tebak-receh",name:"Tebak Receh",desc:"Receh"},
    {id:"cpns",name:"CPNS",desc:"Tes CPNS"},
    {id:"logika",name:"Logika",desc:"Tes Logika"},
    {id:"mtk",name:"MTK",desc:"Tes Matematika"},
    {id:"it",name:"IT",desc:"Soal IT"},
    {id:"agama hindu",name:"Agama Hindu",desc:""},
    {id:"agama buddha",name:"Agama Buddha",desc:""},
    {id:"agama katolik",name:"Agama Katolik",desc:""},
    {id:"agama konghucu",name:"Agama Konghucu",desc:""},
    {id:"agama protestan",name:"Agama Protestan",desc:""},
    {id:"agama kristen",name:"Agama Kristen",desc:""}
  ],
  avatars: [
    "./static/avatars/3f983b9ca5618e87e3734751e643c00a.jpg",
    "./static/avatars/23f038cc913bb02b9b58bc7d8418dd6d.jpg",
    "./static/avatars/41bb3d263d7697d065daef857a33bad9.jpg",
    "./static/avatars/adad96e29d8f85ab783efedc4bf77339.jpg",
    "./static/avatars/b4be2a5c52b166134c6a6b219836dcb1.jpg",
    "./static/avatars/4e339904b7614b9f80ba2d1f65c62ea1.jpg",
    "./static/avatars/c69a2653915d4f413e5450f1a87a2bc5.jpg",
    "./static/avatars/be6f89e2633168738acf2deb817cfeb6.jpg",
    "./static/avatars/a975a06b73c871fd961c088eb19ed64a (1).jpg"
  ],
  themes: [
    {id:"light",name:"Terang 1",class:""},
    {id:"dark", name:"Gelap 1",class:"dark"}
  ],
  questions: {
    ipa:{mudah:[
      {id:1,question:"Planet terdekat dari matahari?",options:{a:"Venus",b:"Bumi",c:"Mars",d:"Merkurius"},correctAnswer:"d",image:""},
      {id:2,question:"Fungsi mitokondria?",options:{a:"Fotosintesis",b:"Pembangkit energi sel",c:"Kontrol aktivitas sel",d:"Sintesis protein"},correctAnswer:"b",image:""}
    ],normal:[],sulit:[]},
    it:{mudah:[
      {id:3,question:"HTML kepanjangannya?",options:{a:"Hyperlinks and Text Markup Language",b:"HyperText Markup Language",c:"Home Tool Markup Language",d:"Hyper Text Makeup Language"},correctAnswer:"b",image:""}
    ],normal:[],sulit:[]}
  },
  current:{cat:"",lvl:"", list:[], i:0, answers:[], start:0}
};

/* ========== UTIL ========== */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const escapeHTML = s => (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));

/* ========== NAV & INIT ========== */
function show(id){ $$(".page").forEach(p=>p.classList.remove("active")); $("#"+id).classList.add("active"); }
function save(){ localStorage.setItem("tebakz", JSON.stringify({player:app.player,scores:app.scores,questions:app.questions})); }
function load(){
  try{
    const raw = localStorage.getItem("tebakz");
    if(raw){
      const d = JSON.parse(raw);
      if(d.player) app.player = d.player;
      if(Array.isArray(d.scores)) app.scores = d.scores;
      if(d.questions) mergeQuestions(d.questions); // local merge
    }
  }catch(e){}
}

document.addEventListener("click",e=>{
  const g=e.target.dataset.goto; if(g){ show(g); if(g==="scores") renderScores(); if(g==="home") renderCats(); }
});

$("#logoutBtn").onclick=()=>{
  if(confirm("Yakin logout?")){ app.player={name:"",avatar:"",theme:"light"}; save(); show("login"); renderLogin(); }
};

$("#adminLink").onclick=()=>{
  const p = prompt("Password admin:");
  if(p===ADMIN_PASSWORD){ renderAdmin(); show("admin"); }
  else if(p!==null){ alert("Password salah"); }
};

document.addEventListener("DOMContentLoaded", async ()=>{
  load();
  await pullQuestionsJSON(); // baca questions.json di repo (kalau ada)
  renderLogin();
  renderCats();
});

/* ========== LOGIN UI ========== */
function renderLogin(){
  $("#playerName").value = app.player.name||"";
  $("#hiName").textContent = app.player.name||"Pemain";

  const aW=$("#avatarWrap"); aW.innerHTML="";
  app.avatars.forEach((src,i)=>{
    const img=document.createElement("img"); img.src=src; img.className="avatar";
    if(!app.player.avatar && i===0) app.player.avatar=src;
    if(app.player.avatar===src) img.classList.add("active");
    img.onclick=()=>{ $$(".avatar").forEach(x=>x.classList.remove("active")); img.classList.add("active"); app.player.avatar=src; save(); }
    aW.appendChild(img);
  });

  const tW=$("#themeWrap"); tW.innerHTML="";
  app.themes.forEach(t=>{
    const b=document.createElement("button"); b.className="btn outline"; b.textContent=t.name;
    b.onclick=()=>{ document.body.classList.toggle("dark", t.id==="dark"); app.player.theme=t.id; save(); }
    if(app.player.theme===t.id) document.body.classList.toggle("dark", t.id==="dark");
    tW.appendChild(b);
  });

  $("#startBtn").onclick=()=>{
    const n=$("#playerName").value.trim();
    if(!n) return alert("Isi nama dulu");
    app.player.name=n; $("#hiName").textContent=n; save(); show("home");
  };
}

/* ========== HOME (KATEGORI) ========== */
function renderCats(){
  const wrap=$("#cats"); wrap.innerHTML="";
  app.categories.forEach(c=>{
    const card=document.createElement("div"); card.className="card"; card.style.flex="1 1 280px";
    card.innerHTML=`<h3>${c.name}</h3><p class="muted">${c.desc||""}</p>
    <div class="levels">
      <button class="btn outline" data-lvl="mudah">Mudah</button>
      <button class="btn outline" data-lvl="normal">Normal</button>
      <button class="btn outline" data-lvl="sulit">Sulit</button>
    </div>`;
    card.querySelectorAll("button").forEach(b=>{
      b.onclick=()=>startQuiz(c.id, b.dataset.lvl);
    });
    wrap.appendChild(card);
  });
}

/* ========== QUIZ ========== */
function startQuiz(cat,lvl){
  const bank = app.questions[cat]?.[lvl];
  const list = (Array.isArray(bank)&&bank.length)? bank : [{id:Date.now(),question:`Contoh soal ${cat} (${lvl})`,options:{a:"A",b:"B",c:"C",d:"D"},correctAnswer:"a",image:""}];

  app.current={cat,lvl,list,i:0,answers:[],start:Date.now()};
  $("#qCat").textContent = "Kategori: "+cat.toUpperCase();
  show("quiz");
  renderQ();
}

function renderQ(){
  const {list,i}=app.current;
  if(i>=list.length){ return finishQuiz(); }
  const q=list[i];
  $("#qText").textContent=q.question;
  $("#qMeta").textContent=`${app.current.lvl} · ${i+1}/${list.length}`;
  $("#qProg").style.width = (i/list.length*100)+"%";

  const img=$("#qImg");
  if(q.image){ img.src=q.image; img.classList.remove("hidden"); } else img.classList.add("hidden");

  const opts=$("#opts"); opts.innerHTML="";
  Object.entries(q.options).forEach(([k,v])=>{
    const d=document.createElement("div"); d.className="option"; d.dataset.key=k; d.innerHTML=`<b>${k.toUpperCase()}.</b> ${escapeHTML(v)}`;
    if(app.current.answers[i]===k) d.classList.add("selected");
    d.onclick=()=>{ $$("#opts .option").forEach(x=>x.classList.remove("selected")); d.classList.add("selected"); app.current.answers[i]=k; };
    opts.appendChild(d);
  });

  $("#nextBtn").onclick=()=>{
    if(!app.current.answers[i]) return alert("Pilih jawaban dulu");
    app.current.i++; renderQ();
  };
}

function finishQuiz(){
  const {list,answers,start,cat,lvl}=app.current;
  let score=0;
  const detail = list.map((q,idx)=>{
    const a=answers[idx]; const ok=a===q.correctAnswer; if(ok) score++;
    return {q:q.question,u:a?q.options[a]:"-",c:q.options[q.correctAnswer],ok};
  });

  $("#scoreText").textContent=`Skor: ${score}/${list.length}`;
  const cont=$("#answerList"); cont.innerHTML="";
  detail.forEach((d,i)=>{
    const box=document.createElement("div"); box.className="card";
    box.style.borderLeft=`5px solid ${d.ok?"#2e7d32":"#c62828"}`;
    box.innerHTML=`<p><b>Soal ${i+1}.</b> ${d.q}</p><p>Jawabanmu: ${d.u}</p><p>Benar: ${d.c}</p>`;
    cont.appendChild(box);
  });

  const rec={name:app.player.name||"Pemain",score,total:list.length,category:cat,level:lvl,ms:Math.max(1,Date.now()-start),date:new Date().toISOString()};
  app.scores.push(rec);
  app.scores.sort((a,b)=> b.score-a.score || a.ms-b.ms || new Date(a.date)-new Date(b.date));
  app.scores=app.scores.slice(0,100);
  save();

  show("result");
}

/* ========== SCORES ========== */
function renderScores(){
  const tb=$("#scoreTable tbody"); tb.innerHTML="";
  $("#emptyScore").style.display = app.scores.length?"none":"block";
  app.scores.forEach((s,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td><td>${escapeHTML(s.name)}</td><td>${s.score}</td><td>${s.score}/${s.total}</td><td>${s.category.toUpperCase()}</td><td>${s.level}</td><td>${Math.round(s.ms/1000)} dtk</td><td>${new Date(s.date).toLocaleString("id-ID")}</td>`;
    tb.appendChild(tr);
  });
}
$("#resetScores").onclick=()=>{ if(confirm("Hapus semua top score?")){ app.scores=[]; save(); renderScores(); } };

/* ========== ADMIN ========== */
function renderAdmin(){
  // kategori dropdown
  const s=$("#aCat"); s.innerHTML="";
  app.categories.forEach(c=>{ const o=document.createElement("option"); o.value=c.id; o.textContent=c.name; s.appendChild(o); });

  $("#addQ").onclick=()=>{
    const cat=$("#aCat").value, lvl=$("#aLvl").value;
    const q=$("#aQ").value.trim(), a=$("#aA").value.trim(), b=$("#aB").value.trim(), c=$("#aC").value.trim(), d=$("#aD").value.trim();
    const img=$("#aImg").value.trim(), ans=$("#aAns").value;
    if(!q||!a||!b||!c||!d) return alert("Pertanyaan & semua opsi (A–D) wajib diisi.");
    ensureCat(cat);
    app.questions[cat][lvl].push({id:Date.now(),question:q,options:{a,b,c,d},correctAnswer:ans,image:img});
    $("#aQ").value=$("#aA").value=$("#aB").value=$("#aC").value=$("#aD").value=$("#aImg").value="";
    save(); renderAdminList(cat,lvl);
    alert("Soal ditambahkan!");
  };

  $("#importFile").onclick=()=>{
    const inp=document.createElement("input"); inp.type="file"; inp.accept="application/json";
    inp.onchange=async ()=>{ const f=inp.files?.[0]; if(!f) return;
      try{ const txt=await f.text(); const data=JSON.parse(txt); mergeQuestions(data); save(); alert("Impor OK. Jangan lupa commit ke questions.json kalau mau dibaca device lain."); renderAdminList(); }
      catch(e){ alert("File JSON tidak valid"); }
    };
    inp.click();
  };

  $("#exportCopy").onclick=async ()=>{
    const blob=JSON.stringify(app.questions,null,2);
    try{ await navigator.clipboard.writeText(blob); alert("JSON disalin ke clipboard.\nBuka GitHub → questions.json → paste & commit."); }
    catch(e){ alert("Clipboard gagal. Gunakan tombol Unduh JSON lalu upload ke GitHub."); }
  };

  $("#downloadJson").onclick=()=>{
    const a=document.createElement("a");
    a.href=URL.createObjectURL(new Blob([JSON.stringify(app.questions,null,2)],{type:"application/json"}));
    a.download="questions.json"; a.click(); URL.revokeObjectURL(a.href);
  };

  renderAdminList();
}

function renderAdminList(fCat=null,fLvl=null){
  const wrap=$("#adminList"); wrap.innerHTML="";
  Object.entries(app.questions).forEach(([cat,levels])=>{
    if(fCat && cat!==fCat) return;
    ["mudah","normal","sulit"].forEach(lvl=>{
      if(fLvl && lvl!==fLvl) return;
      const arr=levels[lvl]||[];
      const box=document.createElement("div"); box.className="card";
      box.innerHTML=`<h4>${cat.toUpperCase()} · ${lvl} <span class="muted">(${arr.length} soal)</span></h4>`;
      if(!arr.length){ box.innerHTML+=`<p class="muted">Belum ada soal.</p>`; wrap.appendChild(box); return; }
      const list=document.createElement("div");
      arr.forEach((q,idx)=>{
        const row=document.createElement("div"); row.style.cssText="display:flex;gap:8px;align-items:center;margin:8px 0";
        row.innerHTML=`<div style="flex:1">${idx+1}. ${escapeHTML(q.question)}</div>`;
        const del=document.createElement("button"); del.className="btn warn"; del.textContent="Hapus";
        del.onclick=()=>{ if(confirm("Hapus soal ini?")){ arr.splice(idx,1); save(); renderAdminList(fCat,fLvl); } };
        row.appendChild(del); list.appendChild(row);
      });
      box.appendChild(list); wrap.appendChild(box);
    });
  });
}

function ensureCat(cat){
  if(!app.questions[cat]) app.questions[cat]={mudah:[],normal:[],sulit:[]};
  ["mudah","normal","sulit"].forEach(k=>{ if(!Array.isArray(app.questions[cat][k])) app.questions[cat][k]=[]; });
}

function mergeQuestions(src){
  Object.entries(src||{}).forEach(([cat,levels])=>{
    ensureCat(cat);
    ["mudah","normal","sulit"].forEach(k=>{
      if(Array.isArray(levels?.[k])) app.questions[cat][k] = levels[k]; // replace (lebih rapi)
    });
  });
}

/* ========== BACA questions.json DI REPO ========== */
async function pullQuestionsJSON(){
  try{
    // relative path supaya jalan di subfolder (mis. /tebakz/)
    const res = await fetch("questions.json?ts="+Date.now(), {cache:"no-store"});
    if(res.ok){
      const data=await res.json();
      mergeQuestions(data);
      save();
    }
  }catch(e){ /* skip kalau ga ada file */ }
}
</script>
</body>
</html>
